#+OPTIONS: html-postamble:auto toc:nil num:nil
#+OPTIONS: html-preamble:nil html-postamble:nil html-scripts:t html-style:nil
#+TITLE: Note Trainer

#+DESCRIPTION: Note Trainer
#+KEYWORDS: Note Trainer
#+HTML_HEAD_EXTRA: <link rel="shortcut icon" href="./../images/favicon.ico" type="image/x-icon">
#+HTML_HEAD_EXTRA: <link rel="icon" href="./../images/favicon.ico" type="image/x-icon">
#+HTML_HEAD_EXTRA:  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
#+HTML_HEAD_EXTRA:  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
#+HTML_HEAD_EXTRA:  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
#+HTML_HEAD_EXTRA:  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
#+HTML_HEAD_EXTRA:  <script src="./elm.js"></script>
#+HTML_HEAD_EXTRA:  <link rel="stylesheet" href="./../css/main.css">
#+HTML_HEAD_EXTRA:  <link rel="stylesheet" href="./../css/blog.css">
#+HTML_HEAD_EXTRA: <style>body { padding-top: 100px; } </style>

* Note Trainer
:PROPERTIES:
:HTML_CONTAINER: nav
:HTML_CONTAINER_CLASS: navbar navbar-inverse navbar-fixed-top
:CUSTOM_ID: navbar
:END:

#+BEGIN_EXPORT html
<div class="container-fluid">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#collapsableNavbar">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="./../index.html">
      <img class="img-circle" src="https://www.gravatar.com/avatar/aa7f68a32b011ac94698a7a1cb16ffc8?s=200" width="50px"/>
    </a>
  </div>
  <div class="collapse navbar-collapse" id="collapsableNavbar">
    <ul class="nav navbar-nav">
      <li><a title="Articles" href="./../articles.html" class="navbar-text h3">Articles</a></li>
      <li><a title="Books" href="./../books.html" class="navbar-text h3">Books</a></li>
      <li><a title="Albums" href="./../albums.html" class="navbar-text h3">Albums</a></li>
      <li><a title="Note Trainer" href="./../NoteTrainer/NoteTrainer.html" class="navbar-text h3">Note Trainer</a></li>
    </ul>
  </div>
</div>
#+END_EXPORT

* Note Trainer
:PROPERTIES:
:CUSTOM_ID: NoteTrainer
:END:

#+BEGIN_EXPORT HTML
<div id="NoteTrainer"></div>
#+END_EXPORT

#+name: embedElm
#+begin_src javascript :exports none
  var app = Elm.Main.init({
      node: document.getElementById('NoteTrainer')
  });

  var audioCtx;
  var volume;
  var volumeSlide;

  $(document).ready(function(){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)
      volume = audioCtx.createGain();
      volumeSlide = document.getElementById("volumeSlider");

      volume.connect(audioCtx.destination);
      volume.gain.value = volumeSlide.value / 100;
  });

  app.ports.play.subscribe(function(music) {
      const audioCtxTime = audioCtx.currentTime;
      const releaseTime = music.seconds * 0.2;
      const attackTime = music.seconds * 0.2;

      volume.gain.linearRampToValueAtTime(volumeSlide.value / 100, audioCtxTime + attackTime);
      volume.gain.linearRampToValueAtTime(0, audioCtxTime + music.seconds - releaseTime);

      var synths = music.frequencies.map(frequency => {
          var synth = audioCtx.createOscillator();
          synth.frequency.value = frequency;
          synth.type = music.oscillatorwave;
          synth.connect(volume);
          return synth;
      });

      synths.forEach((synth) => {
          synth.start(audioCtxTime);
          synth.stop(audioCtxTime + music.seconds);
      });
  });
#+end_src
#+call: ../templates.org:inline-js(blk="embedElm")
