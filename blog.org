#+OPTIONS: html-postamble:auto toc:nil num:nil
#+OPTIONS: html-preamble:nil html-postamble:nil html-scripts:t html-style:nil
#+TITLE: Blog
#+DESCRIPTION: Blog
#+KEYWORDS: Blog
#+HTML_HEAD_EXTRA: <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
#+HTML_HEAD_EXTRA: <link rel="icon" href="images/favicon.ico" type="image/x-icon">
#+HTML_HEAD_EXTRA:  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
#+HTML_HEAD_EXTRA:  <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
#+HTML_HEAD_EXTRA:  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
#+HTML_HEAD_EXTRA:  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
#+HTML_HEAD_EXTRA: <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
#+HTML_HEAD_EXTRA: <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
#+HTML_HEAD_EXTRA:  <link rel="stylesheet" href="css/main.css">
#+HTML_HEAD_EXTRA:  <link rel="stylesheet" href="css/blog.css">

* Blog
:PROPERTIES:
:HTML_CONTAINER: nav
:HTML_CONTAINER_CLASS: navbar bg-dark border-bottom border-body navbar-fixed-top navbar-expand-lg bg-body-tertiary
:CUSTOM_ID: navbar
:END:

#+CALL: templates.org:navbar(1)


* Articles
:PROPERTIES:
:CUSTOM_ID: Articles
:HTML_CONTAINER_CLASS: row container-md py-4 m-auto
:END:

#+CALL: templates.org:articlesRelativePaths()

#+NAME: pagination
#+BEGIN_SRC javascript :exports none
  const perPage = 6;
  const page =
    ((new URLSearchParams(window.location.search).get("page") || 1) - 1);
  const rowsPerPage = 2;
  let articlePerRow = Math.floor(perPage / rowsPerPage);
  let articlesPerPage = Math.round(htmlArticles.length / perPage);

  for (j = 0; j < rowsPerPage; j++) {
    $("#text-Articles").append(`<div class="row" id="articlesRow${j}"></div>`);
  }
  $("#text-Articles").append(`<nav> <ul id="pagination" class="pagination"> </ul> </nav>`)

  for (var i = 0; i < articlesPerPage; i++) {
    var active = "";
    if (page == i) {
      active = 'active" aria-current="page';
    }
    $("#pagination").append(
      '<li class="page item ' +
        active +
        '"><a class="page-link" href="' +
        window.location.href.split("?")[0] +
        "?page=" +
        (i + 1) +
        '">' +
        (i + 1) +
        "</a></li>",
    );

    let cardRow = Math.floor(i / (rowsPerPage + 1));
    let cardWidth = 12 / articlePerRow;
    let cardIndex = page * perPage + i;
    if (cardIndex < htmlArticles.length) {
      let card = $(`<div class="col-md-${cardWidth} p-2"></div>`).append(
        $(
          `<div id=wrap${i} class="card bg-dark text-white" data-include="article${cardIndex}"></div>`,
        ).append(
          `<div class="card-body">
      <h5 class="card-title"></h5>
      <p class="card-text"></p>
      <a href="#" class="stretched-link"></a>
    </div>`,
        ),
      );
      $(`#articlesRow${cardRow}`).append(card);
    }
  }
#+END_SRC
#+CALL: templates.org:inline-js(blk="pagination")

#+name: blog_populateArticles
#+begin_src javascript :exports none
  // Pagination 0 based
  const htmlArticlesPaginated = htmlArticles.slice(
    page * perPage,
    (page * perPage) + perPage,
  );
  const htmlArticlesPathsPaginated = htmlArticlesPaths.slice(
    page * perPage,
    (page * perPage) + perPage,
  );

  var articleHtmlElements = $("[data-include]").map(function (index, item) {
    return [
      [
        $(item).find(".card-title")[0],
        $(item).find(".card-text")[0],
        $(item).find(".stretched-link")[0],
      ],
    ];
  });

  var articlesZip = [];

  for (var i = 0; i < htmlArticlesPaginated.length; i++) {
    articlesZip.push([
      articleHtmlElements[i][0],
      articleHtmlElements[i][1],
      articleHtmlElements[i][2],
      $($.parseHTML(htmlArticlesPaginated[i])).find("#Article").text(),
      $($.parseHTML(htmlArticlesPaginated[i])).find(
        "#outline-container-ArticleAbstract",
      ),
      htmlArticlesPathsPaginated[i],
    ]);
  }

  articlesZip.forEach(function (tuple) {
    const [cardTitle, cardText, stretchedLink, title, abstract, path] = tuple;
      debugger;
    $(cardTitle).html(title);
    $(cardText).html(abstract);
    $(stretchedLink).attr("href", path);
  });
  /* Attributes and classes that I can't add by plain org */

  document.getElementById("content").classList.add("container-fluid", "p-0");
  document.getElementById("text-navbar").classList.add("container-fluid");
  document
    .getElementById("outline-container-navbar")
    .setAttribute("data-bs-theme", "dark");
  document.getElementById("text-Articles").classList.add("m-auto", "col-md-10");
#+end_src
#+call: templates.org:inline-js(blk="blog_populateArticles")
#+call: templates.org:compileOrgFiles()
