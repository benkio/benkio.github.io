<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-10-31 Fri 20:00 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minimal Regex Length</title>
<meta name="author" content="Enrico Benini" />
<meta name="description" content="Minimal Regex Length" />
<meta name="keywords" content="Minimal Regex Length" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="../images/favicon.ico" type="image/x-icon">
<link rel="icon" href="../images/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="../css/main.css">
<link rel="stylesheet" href="../css/blog.css">
<link rel="stylesheet" href="../css/article.css">
<script>
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
// @license-end
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Minimal Regex Length</h1>
<nav id="outline-container-navbar" class="outline-2 navbar bg-dark border-bottom border-body navbar-fixed-top navbar-expand-lg bg-body-tertiary">
<h2 id="navbar">Blog</h2>
<div class="outline-text-2" id="text-navbar">
<a target="_self" class="navbar-brand" href="/index.html">
  <img class="img-circle rounded-circle" src="https://www.gravatar.com/avatar/aa7f68a32b011ac94698a7a1cb16ffc8?s=200" width="50px"/>
</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
  <span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarSupportedContent">
  <ul class="navbar-nav me-auto mb-2 mb-lg-0">
    <li class="nav-item"> <a class="nav-link fs-4 active"        aria-current="page" target="_self" href="/blog.html">Blog</a> </li>
    <li class="nav-item"> <a class="nav-link fs-4 "        aria-current="page" target="_self" href="/articles.html">Articles</a> </li>
    <li class="nav-item"> <a class="nav-link fs-4 "        aria-current="page" target="_self" href="/books.html">Books</a> </li>
    <li class="nav-item"> <a class="nav-link fs-4 " aria-current="page" target="_self" href="/albums.html">Albums</a> </li>
    <li class="nav-item"> <a class="nav-link fs-4 "        aria-current="page" target="_self" href="/NoteTrainer/NoteTrainer.html">Note Trainer</a> </li>
  </ul>
</div>
</div>
</nav>
<div id="outline-container-Article" class="outline-2 row">
<h2 id="Article">Minimal Regex Length</h2>
<div class="outline-text-2" id="text-Article">
<p>
<b>Created: <span class="timestamp-wrapper"><span class="timestamp">&lt;2025-10-30 Thu&gt;</span></span></b>
</p>
</div>
<div id="outline-container-ArticleAbstract" class="outline-3">
<h3 id="ArticleAbstract">Abstract</h3>
<div class="outline-text-3" id="text-ArticleAbstract">
<p>
In one of my project I need to get the minimal possible regex length
in order to sort them out from smaller to larger. So, I had to find
a way to get such value. Less trivial then expected
</p>
</div>
</div>
<div id="outline-container-ArticleContent" class="outline-3">
<h3 id="ArticleContent">Content</h3>
<div class="outline-text-3" id="text-ArticleContent">
<p>
There are different approaches to this:
</p>
<dl class="org-dl">
<dt>Add Length Manually üêµ</dt><dd>What I did till now because I couldn't
figure it out and I'm lazy</dd>
<dt>Find a Library That Does It</dt><dd>I couldn't find one. Quite
surprising!! Maybe I'm getting old and I can't find stuff online
anymore. Plus, if I was a good developer/engineer, I would have
started my own library to solve the problem once and for all, but
as I said, I'm lazy. If you know about any library that does it
out of the box, text me, send an email or whatever.</dd>
<dt>Brute Force It (probabilistic to be Fancy)</dt><dd>It might get the job
done if you find a way to create attempts that matches the given
regexp. Not ideal at all, but an improvement compared to the
manual way.</dd>
</dl>

<p>
You can imagine I'm not here to tell you to add them manually üòÖ
</p>

<p>
I recently got back to this and found <a href="https://github.com/wolfendale/scalacheck-gen-regexp">this scalacheck regex lib</a> that
allows you to generate strings based on a regex, so I had a
revelation: <i>What if I could use this to solve my problem?</i>
</p>

<p>
What I did at this point was to:
</p>
<ul class="org-ul">
<li><a href="https://github.com/benkio/sBots/issues/853">Add an Issue to my project</a>, so I remember that this problem needs
to be solved or improved.</li>
<li><a href="https://github.com/wolfendale/scalacheck-gen-regexp/issues/14">Add an issue to the scalacheck regex library</a>, to ask if they know
how to do it based on their internal.</li>
</ul>

<p>
However, I couldn't shake it off my mind, I had to experiment. Try
what I could do with what I have! And I'm here to show you. Sorry in
advance for the bad code, it's not meant to be beautiful, but to
test it's possible and who it run.
</p>

<div class="org-src-container">
<pre class="src src-scala">  <span style="color: #ff7f24;">#!/usr/bin/env scala-cli</span>
//&gt; <span style="color: #00ffff;">using</span> dep io.github.wolfendale::scalacheck-gen-regexp:1.1.0
//&gt; <span style="color: #00ffff;">using</span> dep org.scalacheck::scalacheck:1.19.0

<span style="color: #00ffff;">import</span> <span style="color: #eedd82;">wolfendale</span>.<span style="color: #eedd82;">scalacheck</span>.<span style="color: #eedd82;">regexp</span>.<span style="color: #eedd82;">RegexpGen</span>
<span style="color: #00ffff;">import</span> <span style="color: #eedd82;">org</span>.<span style="color: #eedd82;">scalacheck</span>.<span style="color: #eedd82;">Gen</span>
<span style="color: #00ffff;">import</span> <span style="color: #eedd82;">scala</span>.<span style="color: #eedd82;">util</span>.<span style="color: #eedd82;">matching</span>.<span style="color: #eedd82;">Regex</span>
<span style="color: #00ffff;">import</span> <span style="color: #eedd82;">org</span>.<span style="color: #eedd82;">scalacheck</span>.<span style="color: #eedd82;">rng</span>.<span style="color: #eedd82;">Seed</span>
<span style="color: #00ffff;">import</span> <span style="color: #eedd82;">java</span>.<span style="color: #eedd82;">time</span>.<span style="color: #eedd82;">Instant</span>
<span style="color: #00ffff;">import</span> <span style="color: #eedd82;">java</span>.<span style="color: #eedd82;">time</span>.<span style="color: #eedd82;">Duration</span>


<span style="color: #ff7f24;">// Initial (bad) idea:</span>
<span style="color: #ff7f24;">//   gonna generate 100 samples from a regex and then see if I hit the minimal</span>

<span style="color: #ff7f24;">// Generate 100 sample for the regex.</span>
<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">generate100</span>(<span style="color: #eedd82;">regex</span>: <span style="color: #98fb98;">Regex</span>): <span style="color: #98fb98;">Gen</span>[<span style="color: #98fb98;">List</span>[<span style="color: #98fb98;">String</span>]] =
  <span style="color: #eedd82;">Gen</span>.<span style="color: #87cefa;">listOfN</span>(100, <span style="color: #eedd82;">RegexpGen</span>.<span style="color: #87cefa;">from</span>(<span style="color: #eedd82;">regex</span>.<span style="color: #eedd82;">toString</span>))

<span style="color: #ff7f24;">// Given a regex, I generate 100 samples and get the minimum length</span>
<span style="color: #ff7f24;">// If I can't I explode</span>
<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">minimumRegexLength</span>(<span style="color: #eedd82;">regex</span>: <span style="color: #98fb98;">Regex</span>): <span style="color: #98fb98;">Int</span> =
  <span style="color: #87cefa;">generate100</span>(<span style="color: #eedd82;">regex</span>).<span style="color: #eedd82;">sample</span>.<span style="color: #eedd82;">get</span>.<span style="color: #87cefa;">minBy</span>(<span style="color: #b0c4de;">_</span>.<span style="color: #eedd82;">length</span>).<span style="color: #eedd82;">length</span>

<span style="color: #00ffff;">val</span> <span style="color: #eedd82;">inputExpected</span>: <span style="color: #98fb98;">Map</span>[<span style="color: #98fb98;">Regex</span>, <span style="color: #98fb98;">Int</span>] = <span style="color: #87cefa;">Map</span>(
  <span style="color: #ffa07a;">"(posto|carico) i video"</span>.<span style="color: #eedd82;">r</span> -&gt; 13,
  <span style="color: #ffa07a;">"(restiamo|teniamo) in contatto"</span>.<span style="color: #eedd82;">r</span> -&gt; 19,
  <span style="color: #ffa07a;">"(attraverso i|nei) commenti"</span>.<span style="color: #eedd82;">r</span> -&gt; 12,
  <span style="color: #ffa07a;">"cocod[e&#232;]"</span>.<span style="color: #eedd82;">r</span> -&gt; 6,
  <span style="color: #ffa07a;">"\\bmisc\\b"</span>.<span style="color: #eedd82;">r</span> -&gt; 4,
  <span style="color: #ffa07a;">"\\bm[i]+[a]+[o]+\\b"</span>.<span style="color: #eedd82;">r</span> -&gt; 4,
  <span style="color: #ffa07a;">"\\bsgrida[tr]"</span>.<span style="color: #eedd82;">r</span> -&gt; 7,
  <span style="color: #ffa07a;">"\\brimprover"</span>.<span style="color: #eedd82;">r</span> -&gt; 9,
  <span style="color: #ffa07a;">"(baci )?perugina"</span>.<span style="color: #eedd82;">r</span> -&gt; 8,
  <span style="color: #ffa07a;">"velit[a&#224;]"</span>.<span style="color: #eedd82;">r</span> -&gt; 6,
  <span style="color: #ffa07a;">"ho perso (di nuovo )?qualcosa"</span>.<span style="color: #eedd82;">r</span> -&gt; 17,
  <span style="color: #ffa07a;">"tutti (quanti )?mi criticheranno"</span>.<span style="color: #eedd82;">r</span> -&gt; 22,
  <span style="color: #ffa07a;">"ti voglio (tanto )?bene"</span>.<span style="color: #eedd82;">r</span> -&gt; 14,
  <span style="color: #ffa07a;">"vi voglio (tanto )*bene"</span>.<span style="color: #eedd82;">r</span> -&gt; 14,
  <span style="color: #ffa07a;">"pu[o&#242;] capitare"</span>.<span style="color: #eedd82;">r</span> -&gt; 12,
  <span style="color: #ffa07a;">"dopo (che ho )?mangiato"</span>.<span style="color: #eedd82;">r</span> -&gt; 13,
  <span style="color: #ffa07a;">"\\bops\\b"</span>.<span style="color: #eedd82;">r</span> -&gt; 3,
  <span style="color: #ffa07a;">"mi sto sentendo (bene|in compagnia)"</span>.<span style="color: #eedd82;">r</span> -&gt; 20,
  <span style="color: #ffa07a;">"(25|venticinque) (milioni|mila euro)"</span>.<span style="color: #eedd82;">r</span> -&gt; 10
)

<span style="color: #eedd82;">inputExpected</span>.<span style="color: #87cefa;">forall</span> { <span style="color: #00ffff;">case</span> (<span style="color: #eedd82;">input</span>, <span style="color: #eedd82;">expected</span>) =&gt;
  <span style="color: #00ffff;">val</span> <span style="color: #eedd82;">result</span> = <span style="color: #87cefa;">minimumRegexLength</span>(<span style="color: #eedd82;">input</span>)
  <span style="color: #00ffff;">if</span> (<span style="color: #eedd82;">result</span> != <span style="color: #eedd82;">expected</span>) {
    <span style="color: #87cefa;">println</span>(
      <span style="color: #87cefa;">s</span><span style="color: #ffa07a;">"[RegexMinimumLength] Failed test for </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">input</span><span style="color: #ffa07a;">, expected </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">expected</span><span style="color: #ffa07a;">, got </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">result</span><span style="color: #ffa07a;">"</span>
    )
    <span style="color: #7fffd4;">false</span>
  } <span style="color: #00ffff;">else</span> <span style="color: #7fffd4;">true</span>
}

<span style="color: #ff7f24;">// FAILED as expected. Output</span>
<span style="color: #ff7f24;">// Got [RegexMinimumLength] Failed test for \bm[i]+[a]+[o]+\b, expected 4, got 46</span>

<span style="color: #ff7f24;">// Gonna ask AI what are his suggestions.</span>
<span style="color: #ff7f24;">// Together we come out with an idea:</span>

<span style="color: #ff7f24;">// - Start small in size</span>
<span style="color: #ff7f24;">// - Try to generate the output</span>
<span style="color: #ff7f24;">// - If fail, increase the size and retry</span>
<span style="color: #ff7f24;">// - Exit when you got something</span>

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">canGenerateSize</span>(
  <span style="color: #eedd82;">regex</span>: <span style="color: #98fb98;">Regex</span>,
  <span style="color: #eedd82;">targetSize</span>: <span style="color: #98fb98;">Int</span>,
  <span style="color: #eedd82;">trials</span>: <span style="color: #98fb98;">Int</span> = 100
): <span style="color: #98fb98;">Boolean</span> = {
  <span style="color: #00ffff;">val</span> <span style="color: #eedd82;">params</span> = <span style="color: #eedd82;">Gen</span>.<span style="color: #eedd82;">Parameters</span>.<span style="color: #eedd82;">default</span>.<span style="color: #87cefa;">withSize</span>(<span style="color: #eedd82;">targetSize</span>)
  (1 <span style="color: #eedd82;">to</span> <span style="color: #eedd82;">trials</span>).<span style="color: #87cefa;">exists</span> { <span style="color: #b0c4de;">_</span> =&gt;
    <span style="color: #eedd82;">RegexpGen</span>.<span style="color: #87cefa;">from</span>(<span style="color: #eedd82;">regex</span>.<span style="color: #eedd82;">toString</span>).<span style="color: #87cefa;">apply</span>(<span style="color: #eedd82;">params</span>, <span style="color: #eedd82;">Seed</span>.<span style="color: #87cefa;">random</span>())
      .<span style="color: #87cefa;">exists</span>(<span style="color: #eedd82;">v</span> =&gt; <span style="color: #00ffff;">if</span> (<span style="color: #eedd82;">v</span>.<span style="color: #eedd82;">length</span> == <span style="color: #eedd82;">targetSize</span>) {
        <span style="color: #ff7f24;">//println(s"[RegexMinimumLength] find a match for $regex: $v")</span>
        <span style="color: #7fffd4;">true</span>
      } <span style="color: #00ffff;">else</span> <span style="color: #7fffd4;">false</span>
      )
  }
}

<span style="color: #00ffff;">def</span> <span style="color: #87cefa;">minimalSize</span>[<span style="color: #eedd82;">T</span>](
  <span style="color: #eedd82;">regex</span>: <span style="color: #98fb98;">Regex</span>,
  <span style="color: #eedd82;">maxProbe</span>: <span style="color: #98fb98;">Int</span> = 50
): <span style="color: #98fb98;">Option</span>[<span style="color: #98fb98;">Int</span>] = {
  <span style="color: #00ffff;">val</span> <span style="color: #eedd82;">start</span>: <span style="color: #98fb98;">Instant</span> = <span style="color: #eedd82;">Instant</span>.<span style="color: #87cefa;">now</span>()
  <span style="color: #00ffff;">val</span> <span style="color: #eedd82;">result</span> = (0 <span style="color: #eedd82;">to</span> <span style="color: #eedd82;">maxProbe</span>).<span style="color: #87cefa;">find</span> { <span style="color: #eedd82;">size</span> =&gt;
    <span style="color: #87cefa;">canGenerateSize</span>(<span style="color: #eedd82;">regex</span>, <span style="color: #eedd82;">size</span>)
  }
  <span style="color: #87cefa;">println</span>(<span style="color: #87cefa;">s</span><span style="color: #ffa07a;">"[RegexMinimumLength] generation took: </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">{</span><span style="color: #eedd82;">Duration</span><span style="color: #eedd82;">.</span><span style="color: #eedd82;">between</span><span style="color: #eedd82;">(</span><span style="color: #eedd82;">start</span><span style="color: #eedd82;">,</span><span style="color: #eedd82;"> </span><span style="color: #eedd82;">Instant</span><span style="color: #eedd82;">.</span><span style="color: #eedd82;">now</span><span style="color: #eedd82;">)</span><span style="color: #eedd82;">.</span><span style="color: #eedd82;">toMillis</span><span style="color: #eedd82;">}</span><span style="color: #ffa07a;">"</span>)
  <span style="color: #eedd82;">result</span>
}

<span style="color: #eedd82;">inputExpected</span>.<span style="color: #87cefa;">forall</span> { <span style="color: #00ffff;">case</span> (<span style="color: #eedd82;">input</span>, <span style="color: #eedd82;">expected</span>) =&gt;
  <span style="color: #00ffff;">val</span> <span style="color: #eedd82;">result</span> = <span style="color: #87cefa;">minimalSize</span>(<span style="color: #eedd82;">input</span>)
  <span style="color: #00ffff;">if</span> (<span style="color: #eedd82;">result</span> != <span style="color: #87cefa;">Some</span>(<span style="color: #eedd82;">expected</span>)) {
    <span style="color: #87cefa;">println</span>(
      <span style="color: #87cefa;">s</span><span style="color: #ffa07a;">"[RegexMinimumLength] Failed test for </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">input</span><span style="color: #ffa07a;">, expected </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">expected</span><span style="color: #ffa07a;">, got </span><span style="color: #ffa07a;">$</span><span style="color: #eedd82;">result</span><span style="color: #ffa07a;">"</span>
    )
    <span style="color: #7fffd4;">false</span>
  } <span style="color: #00ffff;">else</span> <span style="color: #7fffd4;">true</span>
}

<span style="color: #ff7f24;">// THIS WORKS!!! And generally returns pretty fast ~ 25 milliseconds</span>
<span style="color: #ff7f24;">// It's probabilistic tho so it might be wrong, especially if the number</span>
<span style="color: #ff7f24;">// of attempt are low or the regexp is particularly complex</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-ArticleConclusions" class="outline-3">
<h3 id="ArticleConclusions">Conclusions</h3>
<div class="outline-text-3" id="text-ArticleConclusions">
<p>
I hope this could be useful to someone out there. At least this
should be a better start then when I did approach the problem the
first time. (and decided to give up)
</p>

<p>
EDIT: The solution works fine for simple regexp. Long/complex regexp
will take more time. So for those you might be better off counting
the length manually till someone delivers a lib that exposes this
functionality. I learned this by seeing a degrade in my project
performance üòÖ
</p>
</div>
</div>
</div>
<div id="outline-container-ShareButtons" class="outline-2 row">
<h2 id="ShareButtons">Share Buttons</h2>
<div class="outline-text-2" id="text-ShareButtons">
<!-- AddToAny BEGIN -->
<hr>
<div class="a2a_kit a2a_kit_size_32 a2a_default_style">
<a class="a2a_dd" href="https://www.addtoany.com/share"></a>
<a class="a2a_button_facebook"></a>
<a class="a2a_button_twitter"></a>
<a class="a2a_button_whatsapp"></a>
<a class="a2a_button_telegram"></a>
<a class="a2a_button_linkedin"></a>
<a class="a2a_button_email"></a>
</div>
<script async src="https://static.addtoany.com/menu/page.js"></script>
<!-- AddToAny END -->

<script type="text/javascript">
$(function() {
  $('#text-table-of-contents > ul li').first().css("display", "none");
  $('#text-table-of-contents > ul li').last().css("display", "none");
  $('#table-of-contents').addClass("visible-lg")
});
  document.getElementById("content").classList.add("container-fluid","p-0");
  document.getElementById("text-navbar").classList.add("container-fluid");
  document.getElementById("outline-container-navbar").setAttribute("data-bs-theme", "dark");
  document.getElementById("text-Article").classList.add("text-center");
  $('.outline-3').addClass("m-auto").addClass("col-10");
  document.getElementById("text-ShareButtons").classList.add("m-auto", "col-10");
</script>
</div>
</div>
</div>
</body>
</html>
